// src/db/index.ts
import Dexie, { Table } from "dexie";

export type SetEntry = {
  weight: string;
  reps: string;
  machine?: string;
  pain?: number;
};

export type WorkoutEntry = {
  // auto-increment id
  id?: number;
  weekKey: string;            // e.g. "week23Progress"
  dayLabel: string;           // e.g. "ðŸ”´ (Day 153) Monday â€“ Chest Strength"
  exerciseKey: string;        // e.g. `${dayLabel}::Incline Bench Press`
  exerciseName: string;       // e.g. "Incline Bench Press"
  sets: SetEntry[];           // array of sets
  completed?: boolean;
  updatedAt: number;          // timestamp
};

export class Hard75DB extends Dexie {
  workouts!: Table<WorkoutEntry, number>;
  photos!: Table<any, number>;
  measurements!: Table<any, number>;

  constructor() {
    super("Hard75DB");
    this.version(1).stores({
      workouts: "++id,weekKey,exerciseKey,exerciseName,dayLabel,updatedAt",
      photos: "++id,date,fileName",
      measurements: "++id,date,bodyFat,weight",
    });
  }
}

export const db = new Hard75DB();
